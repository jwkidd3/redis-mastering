<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content 7: Production Deployment & Security</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/theme/white.min.css">
    <style>
        .reveal {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }
        .reveal h1, .reveal h2, .reveal h3 {
            color: #2c3e50;
            text-transform: none;
            line-height: 1.2;
        }
        .reveal .slides section {
            text-align: left;
        }
        .reveal h1, .reveal h2, .reveal h3 {
            text-align: center;
        }
        .title-slide {
            background: linear-gradient(135deg, #e8e8e8 0%, #f5f5f5 100%);
        }
        .title-slide h1 {
            color: #2c3e50;
            font-size: 2.5em;
        }
        .session-header {
            background: linear-gradient(135deg, #e8e8e8 0%, #f5f5f5 100%);
        }
        .lab-callout {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
        }
        .lab-callout h2 {
            color: white;
        }
        pre {
            width: 100%;
            font-size: 0.8em;
        }
        .reveal pre code {
            max-height: 500px;
            padding: 15px;
        }
        .two-column {
            display: flex;
            justify-content: space-between;
        }
        .column {
            flex: 1;
            margin: 0 10px;
        }
        .highlight {
            background-color: #fff3cd;
            padding: 10px;
            border-left: 4px solid #ffc107;
            margin: 10px 0;
        }
        .best-practice {
            background-color: #d4edda;
            padding: 10px;
            border-left: 4px solid #28a745;
            margin: 10px 0;
        }
        .warning {
            background-color: #f8d7da;
            padding: 10px;
            border-left: 4px solid #dc3545;
            margin: 10px 0;
        }
        ul {
            font-size: 0.9em;
        }
        .small-text {
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <div class="reveal">
        <div class="slides">
            <!-- Title Slide -->
            <section class="title-slide" data-background-color="#e8e8e8">
                <h1>Production Deployment & Security</h1>
                <h3>Redis in Enterprise Environments</h3>
                <p style="text-align: center;">Day 3 - Session 1</p>
            </section>

            <!-- Session Overview -->
            <section class="session-header">
                <h2>Session Overview</h2>
                <ul>
                    <li>Production Architecture Patterns</li>
                    <li>Security Configuration</li>
                    <li>Network Security</li>
                    <li>Authentication & Authorization</li>
                    <li>Compliance & Auditing</li>
                    <li>Deployment Strategies</li>
                    <li>Container Orchestration</li>
                </ul>
            </section>

            <!-- Production Architecture Patterns -->
            <section class="session-header">
                <h2>Production Architecture Patterns</h2>
            </section>

            <section>
                <h3>Single Instance Pattern</h3>
                <div class="two-column">
                    <div class="column">
                        <h4>Use Cases:</h4>
                        <ul>
                            <li>Development environments</li>
                            <li>Small applications</li>
                            <li>Caching layer only</li>
                            <li>Non-critical data</li>
                        </ul>
                    </div>
                    <div class="column">
                        <h4>Considerations:</h4>
                        <ul>
                            <li>Single point of failure</li>
                            <li>No high availability</li>
                            <li>Simple to manage</li>
                            <li>Lowest cost</li>
                        </ul>
                    </div>
                </div>
                <pre><code class="bash">docker run -d --name redis-prod \
  -p 6379:6379 \
  -v /data/redis:/data \
  redis:7-alpine redis-server \
  --appendonly yes \
  --requirepass StrongPassword123!</code></pre>
            </section>

            <section>
                <h3>Master-Replica Pattern</h3>
                <div class="best-practice">
                    <strong>Best Practice:</strong> Most common production pattern for read-heavy workloads
                </div>
                <pre><code class="javascript">// Master configuration
const master = new Redis({
  host: 'redis-master.company.com',
  port: 6379,
  password: 'master-password'
});

// Replica configuration for reads
const replica = new Redis({
  host: 'redis-replica.company.com',
  port: 6379,
  password: 'replica-password',
  readOnly: true
});</code></pre>
            </section>

            <section>
                <h3>Sentinel Pattern</h3>
                <ul>
                    <li><strong>Automatic Failover:</strong> Promotes replica to master on failure</li>
                    <li><strong>Configuration Management:</strong> Updates client connections</li>
                    <li><strong>Monitoring:</strong> Health checks and notifications</li>
                </ul>
                <pre><code class="bash"># Sentinel configuration
port 26379
sentinel monitor mymaster 192.168.1.10 6379 2
sentinel auth-pass mymaster StrongPassword123!
sentinel down-after-milliseconds mymaster 5000
sentinel parallel-syncs mymaster 1
sentinel failover-timeout mymaster 10000</code></pre>
            </section>

            <!-- Security Configuration -->
            <section class="session-header">
                <h2>Security Configuration</h2>
            </section>

            <section>
                <h3>Authentication Setup</h3>
                <div class="warning">
                    <strong>Warning:</strong> Always enable authentication in production!
                </div>
                <pre><code class="bash"># redis.conf
requirepass YourVeryStrongPassword123!
masterauth YourVeryStrongPassword123!

# ACL configuration (Redis 6+)
aclfile /etc/redis/users.acl</code></pre>
                <pre><code class="javascript">// JavaScript client with auth
const redis = new Redis({
  host: 'localhost',
  port: 6379,
  password: 'YourVeryStrongPassword123!',
  retryStrategy: (times) => Math.min(times * 50, 2000)
});</code></pre>
            </section>

            <section>
                <h3>Access Control Lists (ACL)</h3>
                <div class="small-text">
                    <pre><code class="bash"># Create users with specific permissions
ACL SETUSER alice on >alice_password ~* &* +@all
ACL SETUSER bob on >bob_password ~customer:* +get +set
ACL SETUSER readonly on >readonly_pass ~* &* +@read

# Application-specific users
ACL SETUSER app_write on >app_write_pass \
  ~cache:* ~session:* +@write +@read -flushdb

ACL SETUSER app_read on >app_read_pass \
  ~* &* +@read -keys -scan</code></pre>
                </div>
                <div class="highlight">
                    <strong>Tip:</strong> Use minimal permissions per user/application
                </div>
            </section>

            <section>
                <h3>Network Security</h3>
                <div class="two-column">
                    <div class="column">
                        <h4>Bind Configuration:</h4>
                        <pre><code class="bash"># Secure binding
bind 127.0.0.1 ::1
# Or specific interface
bind 10.0.0.5

# Protected mode
protected-mode yes</code></pre>
                    </div>
                    <div class="column">
                        <h4>Firewall Rules:</h4>
                        <pre><code class="bash"># iptables example
iptables -A INPUT -p tcp \
  --dport 6379 \
  -s 10.0.0.0/24 \
  -j ACCEPT

iptables -A INPUT -p tcp \
  --dport 6379 \
  -j DROP</code></pre>
                    </div>
                </div>
            </section>

            <!-- Lab Callout -->
            <section class="lab-callout">
                <h2>üß™ Lab 11: Session Management & Security</h2>
                <h3>Duration: 45 minutes</h3>
                <p style="text-align: center; font-size: 1.2em;">
                    Implement production-grade session management<br/>
                    with authentication, authorization, and security best practices
                </p>
            </section>

            <!-- TLS/SSL Configuration -->
            <section class="session-header">
                <h2>TLS/SSL Configuration</h2>
            </section>

            <section>
                <h3>Enabling TLS</h3>
                <pre><code class="bash"># redis.conf with TLS
port 0
tls-port 6379
tls-cert-file /path/to/redis.crt
tls-key-file /path/to/redis.key
tls-ca-cert-file /path/to/ca.crt
tls-dh-params-file /path/to/dhparam.pem

# Cipher configuration
tls-ciphers TLSv1.2:!aNULL:!eNULL:!EXPORT
tls-protocols "TLSv1.2 TLSv1.3"</code></pre>
            </section>

            <section>
                <h3>JavaScript TLS Connection</h3>
                <pre><code class="javascript">const redis = new Redis({
  host: 'redis.company.com',
  port: 6379,
  tls: {
    ca: fs.readFileSync('ca.crt'),
    cert: fs.readFileSync('client.crt'),
    key: fs.readFileSync('client.key'),
    rejectUnauthorized: true,
    servername: 'redis.company.com'
  },
  password: 'StrongPassword123!',
  connectTimeout: 10000
});</code></pre>
                <div class="best-practice">
                    <strong>Best Practice:</strong> Always use TLS for production Redis connections
                </div>
            </section>

            <!-- Compliance & Auditing -->
            <section class="session-header">
                <h2>Compliance & Auditing</h2>
            </section>

            <section>
                <h3>Audit Logging</h3>
                <pre><code class="javascript">// Audit middleware for all Redis operations
class AuditedRedis {
  constructor(redis, auditLogger) {
    this.redis = redis;
    this.audit = auditLogger;
  }
  
  async get(key) {
    const start = Date.now();
    const value = await this.redis.get(key);
    this.audit.log({
      operation: 'GET',
      key,
      user: getCurrentUser(),
      timestamp: new Date(),
      duration: Date.now() - start,
      success: value !== null
    });
    return value;
  }
}</code></pre>
            </section>

            <section>
                <h3>Data Privacy Compliance</h3>
                <ul>
                    <li><strong>GDPR:</strong> Personal data encryption and right to deletion</li>
                    <li><strong>PCI DSS:</strong> Credit card data must be encrypted</li>
                    <li><strong>HIPAA:</strong> Healthcare data requires audit trails</li>
                    <li><strong>SOC 2:</strong> Security controls and monitoring</li>
                </ul>
                <div class="highlight">
                    <strong>Implementation:</strong>
                    <ul class="small-text">
                        <li>Encrypt sensitive fields before storing</li>
                        <li>Implement key rotation policies</li>
                        <li>Maintain audit logs for all access</li>
                        <li>Regular security assessments</li>
                    </ul>
                </div>
            </section>

            <!-- Deployment Strategies -->
            <section class="session-header">
                <h2>Deployment Strategies</h2>
            </section>

            <section>
                <h3>Docker Deployment</h3>
                <pre><code class="dockerfile"># Production Dockerfile
FROM redis:7-alpine
COPY redis.conf /usr/local/etc/redis/redis.conf
RUN addgroup -S redis && adduser -S redis -G redis
USER redis
EXPOSE 6379
CMD ["redis-server", "/usr/local/etc/redis/redis.conf"]</code></pre>
                <pre><code class="yaml"># docker-compose.yml
version: '3.8'
services:
  redis:
    build: .
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
      - ./redis.conf:/usr/local/etc/redis/redis.conf
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 5s
      timeout: 3s
      retries: 5</code></pre>
            </section>

            <section>
                <h3>Kubernetes Deployment</h3>
                <div class="small-text">
                    <pre><code class="yaml">apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: redis
spec:
  serviceName: redis
  replicas: 1
  selector:
    matchLabels:
      app: redis
  template:
    metadata:
      labels:
        app: redis
    spec:
      containers:
      - name: redis
        image: redis:7-alpine
        ports:
        - containerPort: 6379
        volumeMounts:
        - name: data
          mountPath: /data
        env:
        - name: REDIS_PASSWORD
          valueFrom:
            secretKeyRef:
              name: redis-secret
              key: password
  volumeClaimTemplates:
  - metadata:
      name: data
    spec:
      accessModes: ["ReadWriteOnce"]
      resources:
        requests:
          storage: 10Gi</code></pre>
                </div>
            </section>

            <!-- Container Orchestration -->
            <section class="session-header">
                <h2>Container Orchestration</h2>
            </section>

            <section>
                <h3>Health Checks</h3>
                <pre><code class="javascript">// Health check endpoint
app.get('/health', async (req, res) => {
  try {
    // Check Redis connection
    const ping = await redis.ping();
    
    // Check memory usage
    const info = await redis.info('memory');
    const memUsed = parseFloat(info.match(/used_memory_human:(\d+\.?\d*)/)[1]);
    
    // Check replication status
    const replication = await redis.info('replication');
    
    res.json({
      status: 'healthy',
      redis: ping === 'PONG' ? 'connected' : 'disconnected',
      memory: `${memUsed}MB`,
      replication: replication.includes('role:master') ? 'master' : 'replica',
      timestamp: new Date()
    });
  } catch (error) {
    res.status(503).json({
      status: 'unhealthy',
      error: error.message
    });
  }
});</code></pre>
            </section>

            <section>
                <h3>Rolling Updates</h3>
                <div class="two-column">
                    <div class="column">
                        <h4>Strategy:</h4>
                        <ul class="small-text">
                            <li>Update replicas first</li>
                            <li>Verify replication sync</li>
                            <li>Failover to updated replica</li>
                            <li>Update former master</li>
                            <li>Restore original topology</li>
                        </ul>
                    </div>
                    <div class="column">
                        <h4>Zero-Downtime Script:</h4>
                        <pre><code class="bash">#!/bin/bash
# Update replica
docker pull redis:7-alpine
docker stop redis-replica
docker run -d --name redis-replica-new \
  redis:7-alpine

# Wait for sync
sleep 10

# Failover
redis-cli -h sentinel \
  SENTINEL failover mymaster</code></pre>
                    </div>
                </div>
            </section>

            <!-- Production Checklist -->
            <section class="session-header">
                <h2>Production Checklist</h2>
            </section>

            <section>
                <h3>Security Checklist</h3>
                <div class="two-column small-text">
                    <div class="column">
                        <h4>Authentication:</h4>
                        <ul>
                            <li>‚òê Strong passwords configured</li>
                            <li>‚òê ACL users created</li>
                            <li>‚òê Default user disabled</li>
                            <li>‚òê Password rotation policy</li>
                        </ul>
                        <h4>Network:</h4>
                        <ul>
                            <li>‚òê Bind to specific interfaces</li>
                            <li>‚òê Firewall rules configured</li>
                            <li>‚òê TLS/SSL enabled</li>
                            <li>‚òê Protected mode enabled</li>
                        </ul>
                    </div>
                    <div class="column">
                        <h4>Operations:</h4>
                        <ul>
                            <li>‚òê Dangerous commands disabled</li>
                            <li>‚òê Audit logging enabled</li>
                            <li>‚òê Monitoring configured</li>
                            <li>‚òê Backup strategy defined</li>
                        </ul>
                        <h4>Compliance:</h4>
                        <ul>
                            <li>‚òê Data encryption at rest</li>
                            <li>‚òê Data encryption in transit</li>
                            <li>‚òê Audit trail maintained</li>
                            <li>‚òê Access reviews scheduled</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section>
                <h3>Deployment Checklist</h3>
                <div class="best-practice">
                    <h4>Pre-Production Verification:</h4>
                    <ul>
                        <li>‚òê Load testing completed</li>
                        <li>‚òê Security scan passed</li>
                        <li>‚òê Disaster recovery tested</li>
                        <li>‚òê Monitoring dashboards ready</li>
                        <li>‚òê Runbooks documented</li>
                        <li>‚òê Team trained on procedures</li>
                    </ul>
                </div>
            </section>

            <!-- Common Security Vulnerabilities -->
            <section class="session-header">
                <h2>Common Security Vulnerabilities</h2>
            </section>

            <section>
                <h3>Top Security Risks</h3>
                <ul>
                    <li><strong>No Authentication:</strong> Default Redis has no password</li>
                    <li><strong>Public Exposure:</strong> Binding to 0.0.0.0 without firewall</li>
                    <li><strong>Weak Passwords:</strong> Simple or default passwords</li>
                    <li><strong>Command Injection:</strong> Dangerous commands enabled</li>
                    <li><strong>Data Leakage:</strong> Unencrypted sensitive data</li>
                </ul>
                <div class="warning">
                    <strong>Critical:</strong> Never expose Redis directly to the internet!
                </div>
            </section>

            <section>
                <h3>Mitigation Strategies</h3>
                <pre><code class="bash"># Disable dangerous commands
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command KEYS ""
rename-command CONFIG "CONFIG_aSdF43"
rename-command SHUTDOWN ""

# Enable command logging for audit
# In redis.conf
slowlog-log-slower-than 0
slowlog-max-len 1000</code></pre>
            </section>

            <!-- Lab Callout -->
            <section class="lab-callout">
                <h2>üß™ Lab 12: Rate Limiting & API Protection</h2>
                <h3>Duration: 45 minutes</h3>
                <p style="text-align: center; font-size: 1.2em;">
                    Build rate limiting and API protection mechanisms<br/>
                    using Redis for DDoS prevention and fair usage
                </p>
            </section>

            <!-- Performance in Production -->
            <section class="session-header">
                <h2>Performance in Production</h2>
            </section>

            <section>
                <h3>Connection Pooling</h3>
                <pre><code class="javascript">// Optimal connection pool configuration
const redis = new Redis({
  host: 'redis.company.com',
  port: 6379,
  password: 'StrongPassword123!',
  
  // Connection pool settings
  maxRetriesPerRequest: 3,
  enableReadyCheck: true,
  enableOfflineQueue: true,
  
  // Performance settings
  lazyConnect: true,
  keepAlive: 30000,
  connectTimeout: 10000,
  
  // Reconnection strategy
  retryStrategy(times) {
    const delay = Math.min(times * 50, 2000);
    return delay;
  }
});</code></pre>
            </section>

            <section>
                <h3>Memory Management</h3>
                <pre><code class="bash"># Memory configuration in redis.conf
maxmemory 2gb
maxmemory-policy allkeys-lru

# Memory optimization
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes</code></pre>
                <div class="highlight">
                    <strong>Monitor memory usage:</strong>
                    <pre><code class="bash">redis-cli INFO memory | grep used_memory_human</code></pre>
                </div>
            </section>

            <!-- Disaster Recovery -->
            <section class="session-header">
                <h2>Disaster Recovery</h2>
            </section>

            <section>
                <h3>Backup Strategies</h3>
                <div class="two-column">
                    <div class="column">
                        <h4>RDB Snapshots:</h4>
                        <pre><code class="bash"># Manual backup
redis-cli BGSAVE

# Automated backup script
#!/bin/bash
BACKUP_DIR="/backup/redis"
DATE=$(date +%Y%m%d_%H%M%S)
redis-cli BGSAVE
sleep 5
cp /var/lib/redis/dump.rdb \
  $BACKUP_DIR/dump_$DATE.rdb</code></pre>
                    </div>
                    <div class="column">
                        <h4>AOF Backup:</h4>
                        <pre><code class="bash"># Enable AOF
appendonly yes
appendfilename "appendonly.aof"

# AOF rewrite
redis-cli BGREWRITEAOF

# Backup AOF
cp appendonly.aof \
  /backup/aof_$(date +%Y%m%d).aof</code></pre>
                    </div>
                </div>
            </section>

            <section>
                <h3>Recovery Procedures</h3>
                <ol>
                    <li><strong>Stop Redis:</strong> Prevent data corruption</li>
                    <li><strong>Restore backup:</strong> Copy RDB/AOF files</li>
                    <li><strong>Verify integrity:</strong> Check file consistency</li>
                    <li><strong>Start Redis:</strong> Load from backup</li>
                    <li><strong>Validate data:</strong> Verify critical keys</li>
                </ol>
                <pre><code class="bash"># Recovery script
systemctl stop redis
cp /backup/redis/dump_20250118.rdb /var/lib/redis/dump.rdb
chown redis:redis /var/lib/redis/dump.rdb
redis-check-rdb /var/lib/redis/dump.rdb
systemctl start redis
redis-cli ping</code></pre>
            </section>

            <!-- Summary -->
            <section class="session-header">
                <h2>Key Takeaways</h2>
                <ul>
                    <li>Always enable authentication and use strong passwords</li>
                    <li>Implement defense in depth with multiple security layers</li>
                    <li>Use TLS/SSL for all production connections</li>
                    <li>Regular backups and tested recovery procedures</li>
                    <li>Monitor and audit all access and operations</li>
                    <li>Follow the principle of least privilege for ACLs</li>
                    <li>Keep Redis updated with security patches</li>
                    <li>Document and test disaster recovery plans</li>
                </ul>
            </section>

            <!-- Next Steps -->
            <section class="session-header">
                <h2>Next Up</h2>
                <h3 style="text-align: center;">Lab 11: Session Management & Security</h3>
                <p style="text-align: center;">
                    Hands-on implementation of production security patterns<br/>
                    including authentication, authorization, and session management
                </p>
            </section>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/highlight/highlight.min.js"></script>
    <script>
        Reveal.initialize({
            hash: true,
            controls: true,
            progress: true,
            center: false,
            transition: 'slide',
            plugins: [ RevealHighlight ]
        });
    </script>
</body>
</html>