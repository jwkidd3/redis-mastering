<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Content 14: Production Monitoring & Performance</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/theme/white.min.css">
    <style>
        .reveal .slides section {text-align: left; font-size: 0.75em !important; line-height: 1.3; max-height: 90vh !important; overflow-y: auto !important; padding: 0.5em 1em !important;}
        .reveal h1 {font-size: 1.8em !important; margin: 0.3em 0 !important;}
        .reveal h2 {font-size: 1.4em !important; margin: 0.3em 0 !important;}
        .reveal h3 {font-size: 1.2em !important; margin: 0.3em 0 !important;}
        .reveal h1, .reveal h2, .reveal h3 {color: #2c3e50; text-align: center;}
        .main-title {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white !important; padding: 1.5em; border-radius: 10px; text-align: center;}
        .session-header {background: #f8f9fa; color: #2c3e50 !important; padding: 0.6em; border-left: 5px solid #3498db; margin-bottom: 0.5em;}
        .code-block {background: #2c3e50; color: #ecf0f1; padding: 0.5em; font-family: monospace; font-size: 0.6em; margin: 0.3em 0; overflow-x: auto;}
        .lab-callout {background: linear-gradient(45deg, #ff6b6b, #ee5a24); color: white !important; padding: 0.8em; border-radius: 8px; text-align: center; margin: 0.5em 0;}
        .warning {background: #fff3cd; border: 1px solid #ffeaa7; padding: 0.5em; margin: 0.3em 0;}
        .success {background: #d4edda; border: 1px solid #c3e6cb; padding: 0.5em; margin: 0.3em 0;}
        .info {background: #e3f2fd; border: 1px solid #bbdefb; padding: 0.5em; margin: 0.3em 0;}
        .reveal .slides section::-webkit-scrollbar {width: 8px;}
        .reveal .slides section::-webkit-scrollbar-thumb {background: #888; border-radius: 4px;}
    </style>
</head>
<body>
    <div class="reveal">
        <div class="slides">
            <section><div class="main-title"><h1>Content 14</h1><h2>Production Monitoring & Performance</h2><p>Redis Insight, Metrics, Optimization</p><p><strong>Day 3 - Session 5</strong></p></div></section>
            
            <section><div class="session-header"><h2>Learning Objectives</h2></div>
                <ul><li>Use Redis Insight for real-time monitoring</li><li>Understand key performance metrics</li><li>Analyze slowlog for performance issues</li><li>Monitor memory usage and fragmentation</li><li>Set up health checks and alerting</li><li>Optimize Redis performance</li></ul>
            </section>

            <section><div class="session-header"><h2>Redis INFO Command</h2></div>
                <div class="code-block">
# Get all info
INFO

# Specific sections
INFO server       # Redis version, uptime
INFO clients      # Connected clients
INFO memory       # Memory usage
INFO stats        # Command statistics
INFO replication  # Replication status
INFO persistence  # RDB/AOF status
INFO cpu          # CPU usage
INFO keyspace     # Database key counts
                </div>
            </section>

            <section><div class="session-header"><h2>Key Metrics to Monitor</h2></div>
                <h3>Memory Metrics</h3>
                <ul><li><strong>used_memory:</strong> Total memory used by Redis</li><li><strong>used_memory_rss:</strong> OS-allocated memory</li><li><strong>mem_fragmentation_ratio:</strong> RSS / used_memory (ideal: 1.0-1.5)</li><li><strong>used_memory_peak:</strong> Peak memory since startup</li></ul>
                <div class="code-block">
INFO memory | grep used_memory
INFO memory | grep fragmentation
                </div>
            </section>

            <section><div class="session-header"><h2>Performance Metrics</h2></div>
                <h3>Operations & Latency</h3>
                <ul><li><strong>total_commands_processed:</strong> Total commands executed</li><li><strong>instantaneous_ops_per_sec:</strong> Current throughput</li><li><strong>keyspace_hits / keyspace_misses:</strong> Cache hit rate</li><li><strong>evicted_keys:</strong> Keys removed due to maxmemory</li></ul>
                <div class="code-block">
INFO stats | grep commands
INFO stats | grep ops_per_sec
INFO stats | grep keyspace

# Calculate hit rate
hits / (hits + misses) * 100
                </div>
            </section>

            <section><div class="session-header"><h2>Slowlog Analysis</h2></div>
                <div class="code-block">
# Configure slowlog threshold (10ms)
CONFIG SET slowlog-log-slower-than 10000

# View slow commands
SLOWLOG GET 10

# Slowlog entry format:
# 1) ID
# 2) Timestamp
# 3) Execution time (microseconds)
# 4) Command array
# 5) Client info

# Reset slowlog
SLOWLOG RESET
                </div>
                <div class="warning"><strong>Action Required:</strong> Optimize or cache commands appearing frequently in slowlog</div>
            </section>

            <section><div class="session-header"><h2>Redis Insight Features</h2></div>
                <h3>Key Analysis Tools</h3>
                <ul><li><strong>Memory Analysis:</strong> Identify large keys</li><li><strong>Key Browser:</strong> Explore data structures</li><li><strong>Workbench:</strong> Execute commands and queries</li><li><strong>Profiler:</strong> Real-time command monitoring</li><li><strong>Slowlog:</strong> Visualize slow queries</li><li><strong>Database Analysis:</strong> Key distribution and memory</li></ul>
                <div class="info"><strong>Best Practice:</strong> Use Memory Analysis weekly to find memory leaks</div>
            </section>

            <section><div class="session-header"><h2>Client Connection Monitoring</h2></div>
                <div class="code-block">
# List connected clients
CLIENT LIST

# Get number of clients
INFO clients | grep connected_clients

# Kill specific client
CLIENT KILL ip:port

# Set client name (for tracking)
CLIENT SETNAME "app-server-1"

# Get current client info
CLIENT INFO
                </div>
            </section>

            <section><div class="session-header"><h2>Command Statistics</h2></div>
                <div class="code-block">
# Get command stats
INFO commandstats

# Example output:
# cmdstat_get:calls=1000000,usec=500000,usec_per_call=0.50
# cmdstat_set:calls=500000,usec=300000,usec_per_call=0.60
# cmdstat_zadd:calls=100000,usec=200000,usec_per_call=2.00

# Identify top commands and optimize
                </div>
                <div class="success"><strong>Optimization:</strong> Use pipelining for frequently called commands</div>
            </section>

            <section><div class="session-header"><h2>Health Check Implementation</h2></div>
                <div class="code-block">
// Node.js health check endpoint
app.get('/health', async (req, res) => {
    try {
        // Basic connectivity
        await redis.ping();

        // Get key metrics
        const info = await redis.info();
        const memoryUsed = parseInfo(info, 'used_memory');
        const maxMemory = parseInfo(info, 'maxmemory');
        const clients = parseInfo(info, 'connected_clients');

        // Calculate health score
        const memoryUtilization = memoryUsed / maxMemory;
        const isHealthy = memoryUtilization < 0.9 && clients < 900;

        res.status(isHealthy ? 200 : 503).json({
            status: isHealthy ? 'healthy' : 'degraded',
            uptime: parseInfo(info, 'uptime_in_seconds'),
            memoryUtilization: `${(memoryUtilization * 100).toFixed(2)}%`,
            connectedClients: clients,
            opsPerSec: parseInfo(info, 'instantaneous_ops_per_sec')
        });
    } catch (error) {
        res.status(503).json({ status: 'unhealthy', error: error.message });
    }
});
                </div>
            </section>

            <section><div class="session-header"><h2>Performance Optimization Tips</h2></div>
                <ul><li><strong>Use Pipelining:</strong> Batch multiple commands</li><li><strong>Avoid KEYS:</strong> Use SCAN instead</li><li><strong>Set Appropriate TTLs:</strong> Prevent memory bloat</li><li><strong>Use Hashes for Objects:</strong> More memory efficient than strings</li><li><strong>Enable Compression:</strong> For large values</li><li><strong>Monitor Fragmentation:</strong> Restart if ratio > 1.5</li><li><strong>Disable Persistence:</strong> If data is ephemeral/cacheable</li></ul>
            </section>

            <section><div class="session-header"><h2>Alerting Thresholds</h2></div>
                <div class="success"><strong>Recommended Alert Conditions:</strong></div>
                <ul><li><strong>Memory:</strong> > 80% of maxmemory</li><li><strong>Fragmentation:</strong> > 1.5 ratio</li><li><strong>Evictions:</strong> > 100 per minute</li><li><strong>Clients:</strong> > 90% of maxclients</li><li><strong>Replication Lag:</strong> > 10 seconds</li><li><strong>Persistence Failures:</strong> Any RDB/AOF errors</li></ul>
            </section>

            <section><div class="lab-callout"><h2>ðŸ§ª Lab 14: Production Monitoring</h2><p><strong>Duration: 45 minutes</strong></p></div>
                <h3>What You'll Build</h3>
                <ul><li>Real-time monitoring dashboard</li><li>Health check API endpoints</li><li>Slowlog analysis tools</li><li>Memory usage tracking</li><li>Alert threshold detection</li><li>Redis Insight integration</li></ul>
            </section>

            <section><div class="session-header"><h2>Summary</h2></div>
                <ul><li><strong>INFO command</strong> provides comprehensive metrics</li><li><strong>Memory monitoring</strong> prevents OOM crashes</li><li><strong>Slowlog</strong> identifies performance bottlenecks</li><li><strong>Redis Insight</strong> visualizes real-time data</li><li><strong>Health checks</strong> enable proactive monitoring</li><li><strong>Alerting</strong> catches issues before users notice</li></ul>
                <div class="success"><strong>Production Ready!</strong> You can now monitor and optimize Redis in production</div>
            </section>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.js"></script>
    <script>Reveal.initialize({hash: true, center: false});</script>
</body>
</html>
